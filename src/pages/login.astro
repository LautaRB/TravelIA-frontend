---
//export const prerender = false;
import Layout from "../layouts/BaseLayout.astro";
---

<Layout>
  <html lang="es">
    <body class="min-h-screen flex items-center justify-center bg-ocean-50 p-4">
      <div
        class="w-full h-full max-w-md bg-white shadow-lg rounded-xl p-8 space-y-6"
      >
        <!-- Logo -->
        <div class="flex justify-center">
          <img src="/logo.svg" alt="TravelIA Logo" class="w-20 h-20" />
        </div>

        <!-- Título -->
        <h1 class="text-2xl font-semibold text-center text-ocean-800">
          Inicia sesión en TravelIA
        </h1>

        <!-- Formulario -->
        <form id="loginForm" class="space-y-4">
          <input
            id="username"
            type="text"
            placeholder="Usuario"
            class="w-full px-4 py-2 border border-ocean-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-ocean-500"
            required
          />

          <input
            id="password"
            type="password"
            placeholder="Contraseña"
            class="w-full px-4 py-2 border border-ocean-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-ocean-500"
            required
          />

          <button
            type="submit"
            class="w-full bg-ocean-500 hover:bg-ocean-600 text-white py-2 rounded-lg font-medium transition"
          >
            Iniciar sesión
          </button>
        </form>

        <!-- Separador -->
        <div class="flex items-center justify-center gap-4 text-ocean-400">
          <span class="flex-1 h-px bg-ocean-200"></span>
          O
          <span class="flex-1 h-px bg-ocean-200"></span>
        </div>

        <!-- Botón Google -->
        <button
          class="w-full flex items-center justify-center gap-3 border border-ocean-300 py-2 rounded-lg hover:bg-ocean-100 transition"
        >
          <img src="/google-icon.svg" alt="Google" class="w-5 h-5" />
          Iniciar sesión con Google
        </button>

        <!-- Registro -->
        <p class="text-center text-ocean-700">
          ¿No tenés una cuenta?
          {/* href="/register" */}
          <a
            href="/register/index.html"
            class="text-ocean-600 font-medium hover:underline"
          >
            Registrate!
          </a>
        </p>
      </div>
    </body>

    <script>
      import { login } from "../services/api/authAPI.ts";

      document.addEventListener("DOMContentLoaded", () => {
        const form = document.querySelector(
          "#loginForm"
        ) as HTMLFormElement | null;

        if (!form) {
          console.error("No se encontró el formulario de login");
          return;
        }

        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          const username = (
            document.getElementById("username") as HTMLInputElement
          ).value;
          const password = (
            document.getElementById("password") as HTMLInputElement
          ).value;

          try {
            const data = await login(username, password);
            
            document.cookie = `authToken=${data.token}; path=/; secure; samesite=strict`;

            //window.location.href = "/dashboard/dashboard";
            window.location.href = "/dashboard/dashboard/index.html";
          } catch (error: any) {
            alert("Error al iniciar sesión: " + error.message);
          }
        });
      });
    </script>
  </html>
</Layout>
